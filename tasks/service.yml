---
- name: Flush handlers to apply configuration
  ansible.builtin.meta: flush_handlers

- name: Ensure dragonfly service is in desired state
  ansible.builtin.systemd:
    name: dragonfly
    state: "{{ dragonfly_service_state }}"
    enabled: "{{ dragonfly_service_enabled }}"
    daemon_reload: true

- name: Wait for dragonfly to start
  ansible.builtin.wait_for:
    host: "{{ dragonfly_bind }}"
    port: "{{ dragonfly_port }}"
    state: started
    timeout: 30
  when: dragonfly_service_state == "started"
